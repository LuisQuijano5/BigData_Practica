import boto3
from decimal import Decimal

dynamodb = boto3.resource("dynamodb")
table = dynamodb.Table("kpi_summary")

def lambda_handler(event, context):
    kpi_keys = ["avg_sale_amount", "total_sales"]

    kpi_data = {}
    
    for kpi_name in kpi_keys:
        try:
            response = table.get_item(
                Key={'kpi_name': kpi_name}
            )
            item = response.get('Item')

            if item:
                value = item.get('value')
                
                if isinstance(value, Decimal):
                    value = float(value)
                    
                kpi_data[kpi_name] = value
            else:
                kpi_data[kpi_name] = "Not Found"

        except Exception as e:
            kpi_data[kpi_name] = f"Error: {str(e)}"
            
    return {
        "status": "ok",
        "kpis": kpi_data
    }


